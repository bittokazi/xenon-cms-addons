<?phpxenon_custom_link('useronlinexenonaddon','xenon-addons/user-online/user-end.php');xenon_add_widget_item('user_online_widget_for_xenon');function user_online_widget_for_xenon() {@ob_start();@session_start();$usernames=$_SESSION["online_user_xenon"];$resultss = @mysql_query("SELECT * FROM user_onlineWHERE phpsession = '$usernames'");if ( @mysql_num_rows($resultss) > 0 ) {while($admins = @mysql_fetch_array($resultss)) {echo 'Your IP: '.$admins[ip].'<br>';echo 'Your User Agent: '.$admins[info].'<br>';}}$resultss = @mysql_query("SELECT * FROM user_online_total_user WHERE id=1");if ( @mysql_num_rows($resultss) > 0 ) {while($admins = @mysql_fetch_array($resultss)) {echo 'Total Visitor: '.$admins[total_visitor].'<br>';}}$resultss = @mysql_query("SELECT * FROM user_online");if ( @mysql_num_rows($resultss) > 0 ) {echo 'online: '.@mysql_num_rows($resultss).'<br>';}else {echo '0+--+';}@ob_flush();}function frndzk_breadc_uo() {$s=$_SERVER['PHP_SELF'];$e=explode('/',$s);return $e[count($e) -1];}if (frndzk_breadc_uo()=='addon.php' && isset($_GET['action']) && isset($_GET['registername']) && $_GET['action']=="activate" && $_GET['registername']=="user-online") {$result = @mysql_query("SELECT * FROM user_online");if ( @mysql_num_rows($result) < 1 ) {$query="CREATE TABLE user_online (id int(255) NOT NULL auto_increment,phpsession text(1000) CHARACTER SET utf8 COLLATE utf8_general_ci,ip text(50) CHARACTER SET utf8 COLLATE utf8_general_ci,info text(1000) CHARACTER SET utf8 COLLATE utf8_general_ci,start text(50) CHARACTER SET utf8 COLLATE utf8_general_ci,finish text(50) CHARACTER SET utf8 COLLATE utf8_general_ci,PRIMARY KEY (id),UNIQUE id (id),KEY id_2 (id))";@mysql_query($query);}}if (frndzk_breadc_uo()=='addon.php' && isset($_GET['action']) && isset($_GET['registername']) && $_GET['action']=="activate" && $_GET['registername']=="user-online") {$result = @mysql_query("SELECT * FROM user_online_total_user");if ( @mysql_num_rows($result) < 1 ) {$query="CREATE TABLE user_online_total_user (id int(5) NOT NULL auto_increment,total_visitor text(100000) CHARACTER SET utf8 COLLATE utf8_general_ci,PRIMARY KEY (id),UNIQUE id (id),KEY id_2 (id))";@mysql_query($query);$query="INSERT INTO user_online_total_user(id,total_visitor) VALUES('','0')";@mysql_query($query);}}function uo_admin() {      option_menu('user-online-admin.php', 'user-online-admin', 'addonpage','1','user online');  }xenon_core('xenon_add_menu', 'uo_admin');//setup finish//checkfunction user_online_xenon() {@ob_start();@session_start();if(isset($_SESSION["online_user_xenon"])) {$usernames=$_SESSION["online_user_xenon"];$resultss = @mysql_query("SELECT * FROM user_onlineWHERE phpsession = '$usernames'");if ( @mysql_num_rows($resultss) > 0 ) {$currenttime=strtotime("now");$endtime=$currenttime+300;$query="UPDATE user_online SET start = '$currenttime'  WHERE phpsession = '$usernames'";@mysql_query($query);$query="UPDATE user_online SET finish = '$endtime'  WHERE phpsession = '$usernames'";@mysql_query($query);}else {$currenttime=strtotime("now");$endtime=$currenttime+300;$usernames=uniqid();$ip=$_SERVER['REMOTE_ADDR'];$info=$_SERVER['HTTP_USER_AGENT'];$query="INSERT INTO user_online VALUES ('','$usernames','$ip','$info','$currenttime','$endtime')";@mysql_query($query);$_SESSION["online_user_xenon"]=$usernames;$resultss = @mysql_query("SELECT * FROM user_online_total_user");if ( @mysql_num_rows($resultss) > 0 ) {while($admins = @mysql_fetch_array($resultss)) {$new=$admins[total_visitor]+1;$query="UPDATE user_online_total_user SET total_visitor = '$new'  WHERE id = 1";@mysql_query($query);}}}//delete expired user$resultss = @mysql_query("SELECT * FROM user_online");if ( @mysql_num_rows($resultss) > 0 ) {while($admins = @mysql_fetch_array($resultss)) {if($admins['finish']<strtotime("now")) {$id=$admins['id'];@mysql_query("DELETE FROM user_online WHERE id='$id'");}}}}else {$currenttime=strtotime("now");$endtime=$currenttime+300;$usernames=uniqid();$ip=$_SERVER['REMOTE_ADDR'];$info=$_SERVER['HTTP_USER_AGENT'];$query="INSERT INTO user_online VALUES ('','$usernames','$ip','$info','$currenttime','$endtime')";@mysql_query($query);$_SESSION["online_user_xenon"]=$usernames;}@ob_flush();}function add_visitor() {$resultss = @mysql_query("SELECT * FROM user_online_total_user");if ( @mysql_num_rows($resultss) > 0 ) {while($admins = @mysql_fetch_array($resultss)) {$new=$admins[total_visitor]+1;$query="UPDATE user_online_total_user SET total_visitor = '$new'  WHERE id = 1";@mysql_query($query);}}}add_visitor();function echo_user_data() {@ob_start();@session_start();$usernames=$_SESSION["online_user_xenon"];$resultss = @mysql_query("SELECT * FROM user_onlineWHERE phpsession = '$usernames'");if ( @mysql_num_rows($resultss) > 0 ) {while($admins = @mysql_fetch_array($resultss)) {echo $admins[ip].'+--+'.$admins[info].'+--+';}}$resultss = @mysql_query("SELECT * FROM user_online_total_user WHERE id=1");if ( @mysql_num_rows($resultss) > 0 ) {while($admins = @mysql_fetch_array($resultss)) {echo $admins[total_visitor].'+--+';}}$resultss = @mysql_query("SELECT * FROM user_online");if ( @mysql_num_rows($resultss) > 0 ) {echo @mysql_num_rows($resultss).'+--+';}else {echo '0+--+';}@ob_flush();}function user_online_header() {return '<script>var xenon_home="'.home_url().'";</script><script language="javascript" type="text/javascript" src="'.home_url().'/xenon-addons/user-online/uo.js"></script>';}xenon_core("xenon_header", "user_online_header");user_online_xenon();function back_end_xenon_user_online() {$resultss = @mysql_query("SELECT * FROM user_online");if ( @mysql_num_rows($resultss) > 0 ) {echo '<table class="listing" cellpadding="0" cellspacing="0">					<tr>						<th class="first" width="177">Serial</th>						<th>IP</th>						<th>User Agent</th>					</tr>';					$id=1;while($admins = @mysql_fetch_array($resultss)) {echo '<tr><td class="first style1">'.$id.'</td>';echo '<td>'.$admins[ip].'</td>';echo '<td>'.$admins[info].'</td></tr>';$id++;}echo '</table>';}else {echo 'NO USER ONLINE NOW!!!!!!!! :/ :/ :/ :/';}}?>